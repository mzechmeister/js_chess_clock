<!DOCTYPE html>
<html>
<head>
    <title>chess clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
#pl_white, #pl_black {
    border: 1px black solid;
    flex-grow: 2;
    font: bold 30vw Roboto;
    margin: 6px;
}

#pl_white {
    transform: rotate(180deg);
}

#pl_white, #pl_black.swap {
    background-color: white;
    color: black;
}

#pl_black, #pl_white.swap {
    background-color: black;
    color: white;
}

#pl_black:after, #pl_white:after {
    content: " "attr(cnt);
    font-size: 18px;
}

button:active, #pl_white:active, #pl_black:active {
    background-color: grey;
}

#control > button {
    border: 1px black solid;
    flex-grow: 1;
    font: bold 5vw Roboto;
    margin: 3px;
}

#control {
    text-align: center;
}

</style>
</head>

<body style="display:flex; flex-flow: column; height: 100vh; margin:0;">
<button id="pl_white" onclick="clickWhite()"></button>

<div id="control">
<button onclick="++t0mm; reset(1)" style="float:left">+</button>
<button onclick="--t0mm; reset(1)" style="float:left">&minus;</button>
<button onclick="reset()">Reset</button>
<button onclick="pause()">Pause</button>
<a href="https://github.com/mzechmeister/js_chess_clock" style="float:right; padding-right: 0.3em;"><svg width="12" height="12" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E"/>
</svg></img></a>
</div>

<button id="pl_black" onclick="clickBlack()"></button>

<script>
t0mm = 10  // [min] default time limit

function reset(prevent_swap) {
    t_white = t0mm * 60 * 1000
    t_black = t0mm * 60 * 1000
    pl_white.innerHTML = tfmt(t_white)
    pl_black.innerHTML = tfmt(t_black)
    if (!prevent_swap) {
        pl_white.classList.toggle("swap")
        pl_black.classList.toggle("swap")
        var swap = document.getElementsByClassName("swap").length
        pl_white.setAttribute('cnt', swap ? -1 : 0)
        pl_black.setAttribute('cnt', swap ? 0 : -1)
    }
    pl_now = null
}

pause = e => {
    if (pl_now == pl_black) t_black = remaining
    if (pl_now == pl_white) t_white = remaining
    pl_now = null
}

clickWhite = e => { 
    if (pl_now == pl_black) return            // black is already running
    if (pl_now != null) t_white = remaining   // after resume from pause
    pl_now = pl_black
    endTime = new Date().getTime() + t_black
    pl_white.setAttribute('cnt', +pl_white.getAttribute('cnt') + 1)
}

clickBlack = e => { 
    if (pl_now == pl_white) return
    if (pl_now != null) t_black = remaining
    pl_now = pl_white
    endTime = new Date().getTime() + t_white
    pl_black.setAttribute('cnt', +pl_black.getAttribute('cnt') + 1)
}

function tfmt(t) {
    // Time calculations for days, hours, minutes and seconds
    var hh = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
    var mm = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60))
    var ss = Math.floor((t % (1000 * 60)) / 1000)
    return mm + ":" + String(ss).padStart(2, '0')
}


function counter() {
    var now = new Date().getTime()
    endTime = now + t_white
 
    // Update the count down every 1 second
    x = setInterval(function() {
        now = new Date().getTime()
        remaining = endTime - now

        if (pl_now) {
            pl_now.innerHTML = tfmt(remaining)
            if (remaining < 0) {
                clearInterval(x);
                pl_now.innerHTML = "EXPIRED"
            }
        }
    }, 500)
}

reset(1)
counter()

</script>

</body>
</html>
