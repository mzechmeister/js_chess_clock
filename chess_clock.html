<!DOCTYPE html>
<html>
<head>
    <title>chess clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
#playerA, #playerB {
    border: 1px black solid;
    flex-grow: 2;
    font: bold 30vw Roboto;
    margin: 6px;
}

#playerA {
    transform: rotate(180deg);
}

#playerA, #playerB.swap {
    background-color: white;
    color: black;
}

#playerB, #playerA.swap {
    background-color: black;
    color: white;
}

#playerB:after, #playerA:after {
    content: " "attr(cnt);
    font-size: 18px;
}

button:active, #playerA:active, #playerB:active {
    background-color: grey;
}

#control > button {
    border: 1px black solid;
    flex-grow: 1;
    font: bold 5vw Roboto;
    margin: 6px;
}

#control {
    text-align: center;
}

</style>
</head>

<body style="display:flex; flex-flow: column; height: 100vh; margin:0;">
<button id="playerA" onclick="clickWhite()"></button>

<div id="control">
<button onclick="++t0mm; reset(1)" style="float:left">+</button>
<button onclick="--t0mm; reset(1)" style="float:left">&minus;</button>
<button onclick="reset()">New &udarr;</button>
<button onclick="pause()">Pause &#10074;&#10074;</button>
<a href="https://github.com/mzechmeister/js_chess_clock" style="float:right; padding-right: 6px;"><svg width="12" height="12" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E"/>
</svg></img></a>
</div>

<button id="playerB" onclick="clickBlack()"></button>

<script>
t0mm = 10  // [min] default time limit

function reset(prevent_swap) {
    timeA = t0mm * 60 * 1000
    timeB = t0mm * 60 * 1000
    playerA.innerHTML = tfmt(timeA)
    playerB.innerHTML = tfmt(timeB)
    if (!prevent_swap) {
        playerA.classList.toggle("swap")
        playerB.classList.toggle("swap")
        var swap = document.getElementsByClassName("swap").length
        playerA.setAttribute('cnt', swap ? -1 : 0)
        playerB.setAttribute('cnt', swap ? 0 : -1)
    }
    pl_now = null
}

pause = e => {
    if (pl_now == playerA) timeA = remaining
    if (pl_now == playerB) timeB = remaining
    pl_now = null
}

clickWhite = e => { 
    if (pl_now == playerB) return            // black is already running
    if (pl_now != null) timeA = remaining   // after resume from pause
    pl_now = playerB
    endTime = new Date().getTime() + timeB
    playerA.setAttribute('cnt', +playerA.getAttribute('cnt') + 1)
    beep()
}

clickBlack = e => { 
    if (pl_now == playerA) return
    if (pl_now != null) timeB = remaining
    pl_now = playerA
    endTime = new Date().getTime() + timeA
    playerB.setAttribute('cnt', +playerB.getAttribute('cnt') + 1)
    beep()
}

function tfmt(t) {
    // Time calculations for days, hours, minutes and seconds
    var hh = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
    var mm = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60))
    var ss = Math.floor((t % (1000 * 60)) / 1000)
    return mm + ":" + String(ss).padStart(2, '0')
}


function counter() {
    var now = new Date().getTime()
    endTime = now + timeA
 
    // Update the count down every 1 second
    x = setInterval(function() {
        now = new Date().getTime()
        remaining = endTime - now

        if (pl_now) {
            pl_now.innerHTML = tfmt(remaining)
            if (remaining < 0) {
                clearInterval(x);
                pl_now.innerHTML = "EXPIRED"
            }
        }
    }, 500)
}

function beep() {
    var snd = new Audio("data:audio/mpeg;base64,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") 
    snd.play()
}

reset(1)
counter()

</script>

</body>
</html>
